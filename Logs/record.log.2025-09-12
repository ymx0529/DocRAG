2025-09-12 08:59:28,554 - INFO - 
------ 系统启动 ------

2025-09-12 08:59:28,785 - INFO - Use pytorch device_name: cuda:0
2025-09-12 08:59:28,786 - INFO - Load pretrained SentenceTransformer: Qwen/Qwen3-Embedding-0.6B
2025-09-12 08:59:40,465 - INFO - 1 prompt is loaded, with the key: query
2025-09-12 08:59:46,651 - INFO - Dataset/TAT-DQA/01fdc2339641d7d4a8b06f32d937cffd_content_list.json 文档加载成功，共加载了 1 页
2025-09-12 08:59:59,367 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:00:01,237 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:00:06,749 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:00:12,282 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:00:25,748 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:01:19,083 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:02:38,854 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:03:25,688 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:03:33,321 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:03:38,790 - INFO - persona: You are an expert in financial reporting and community analytics. You are skilled at identifying key stakeholders, mapping relationships, and understanding structural dynamics within financial reporting communities. You are adept at helping people uncover influential nodes, communication patterns, and collaborative frameworks in financial reporting ecosystems.
2025-09-12 09:03:38,790 - INFO - prompt_template: 
-Goal-
Given a text document that is potentially relevant to this activity and a list of entity types, identify all entities of those types from the text and all relationships among the identified entities.

-Steps-
1. Identify all entities. For each identified entity, extract the following information:
- entity_name: Name of the entity, capitalized
- entity_type: One of the following types: [organization, financial statement line item, geographic segment, asset type, reporting period, audit committee, auditor, non-audit service, financial disclosure]
- entity_description: Comprehensive description of the entity's attributes and activities
Format each entity output as a JSON entry with the following format:

{"name": <entity name>, "type": <type>, "description": <entity description>}

2. From the entities identified in step 1, identify all pairs of (source_entity, target_entity) that are *clearly related* to each other.
For each pair of related entities, extract the following information:
- source_entity: name of the source entity, as identified in step 1
- target_entity: name of the target entity, as identified in step 1
- relationship_description: explanation as to why you think the source entity and the target entity are related to each other
- relationship_strength: an integer score between 1 to 10, indicating strength of the relationship between the source entity and target entity
Format each relationship as a JSON entry with the following format:

{"source": <source_entity>, "target": <target_entity>, "relationship": <relationship_description>, "relationship_strength": <relationship_strength>}

3. Return output in English as a single list of all JSON entities and relationships identified in steps 1 and 2.

4. If you have to translate into English, just translate the descriptions, nothing else!

-Examples-
######################

Example 1:

entity_types: [organization, financial statement line item, geographic segment, asset type, reporting period, audit committee, auditor, non-audit service, financial disclosure]
text:
3. Operating segments continued 
------------------------
output:
[
  {"name": "OPERATING SEGMENTS", "type": "GEOGRAPHIC SEGMENT", "description": "Operating segments refer to distinct parts of a company's business that are managed separately and are evaluated by the chief operating decision maker, often based on geographic regions, product lines, or customer types. In this context, the company continues to report on its operating segments as part of its financial disclosures."}
]
#############################


Example 2:

entity_types: [organization, financial statement line item, geographic segment, asset type, reporting period, audit committee, auditor, non-audit service, financial disclosure]
text:
1. Non-current assets excludes trade and other receivables, assets recognised from costs to obtain a contract, defined benefit pension plan surplus and deferred tax asset. 
------------------------
output:
[
  {
    "name": "NON-CURRENT ASSETS",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "Non-current assets is a financial statement line item that includes long-term assets not expected to be converted into cash within one year; it explicitly excludes trade and other receivables, assets recognized from costs to obtain a contract, defined benefit pension plan surplus, and deferred tax asset."
  },
  {
    "name": "TRADE AND OTHER RECEIVABLES",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "Trade and other receivables are amounts owed to the company from its customers or other parties in the ordinary course of business, and are excluded from the non-current assets classification."
  },
  {
    "name": "ASSETS RECOGNIZED FROM COSTS TO OBTAIN A CONTRACT",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "These are assets recognized based on incremental costs incurred to secure a customer contract, which are excluded from non-current assets and may be classified as current or non-current depending on the timing of the benefit."
  },
  {
    "name": "DEFINED BENEFIT PENSION PLAN SURPLUS",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "The surplus in a defined benefit pension plan represents the excess of plan assets over the present value of obligations, and is excluded from non-current assets in the financial statement presentation."
  },
  {
    "name": "DEFERRED TAX ASSET",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "A deferred tax asset arises when tax deductions are available in future periods, and it is excluded from the non-current assets category in the given context."
  },
  {
    "name": "NON-CURRENT ASSETS",
    "type": "FINANCIAL STATEMENT LINE ITEM",
    "description": "Non-current assets represent long-term assets held by an organization, and in this context, are explicitly defined to exclude trade and other receivables, assets from contract acquisition costs, defined benefit pension plan surplus, and deferred tax assets."
  },
  {
    "source": "NON-CURRENT ASSETS",
    "target": "TRADE AND OTHER RECEIVABLES",
    "relationship": "Non-current assets explicitly exclude trade and other receivables, indicating a clear classification boundary between them.",
    "relationship_strength": 10
  },
  {
    "source": "NON-CURRENT ASSETS",
    "target": "ASSETS RECOGNIZED FROM COSTS TO OBTAIN A CONTRACT",
    "relationship": "Non-current assets do not include assets arising from costs to obtain a contract, which are separately recognized and excluded from this line item.",
    "relationship_strength": 10
  },
  {
    "source": "NON-CURRENT ASSETS",
    "target": "DEFINED BENEFIT PENSION PLAN SURPLUS",
    "relationship": "The defined benefit pension plan surplus is excluded from the non-current assets line item in the financial statement.",
    "relationship_strength": 10
  },
  {
    "source": "NON-CURRENT ASSETS",
    "target": "DEFERRED TAX ASSET",
    "relationship": "Deferred tax asset is explicitly excluded from the non-current assets classification.",
    "relationship_strength": 10
  }
]
#############################



-Real Data-
######################
entity_types: organization, financial statement line item, geographic segment, asset type, reporting period, audit committee, auditor, non-audit service, financial disclosure
text: {input_text}
######################
output:
2025-09-12 09:03:38,790 - INFO - 
=== 处理第 0 页 ===
2025-09-12 09:03:50,809 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:04:26,326 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:05:33,823 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:06:31,194 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:07:24,244 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:07:32,169 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:07:54,477 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:08:39,994 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:09:33,186 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:09:59,895 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:11:16,493 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:11:25,727 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:11:58,751 - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-12 09:11:58,875 - INFO - 原始图谱构建完成，共 248 个元素
2025-09-12 09:11:58,930 - INFO - 原始图谱包含 248 个元素
2025-09-12 09:11:58,930 - INFO - 发现重复实体组 'non-current assets', 将合并 4 个节点 -> 保留 entityID: [0, 2, 0]
2025-09-12 09:11:58,930 - INFO - 发现重复实体组 '2018', 将合并 2 个节点 -> 保留 entityID: [0, 3, 3]
2025-09-12 09:11:58,930 - INFO - 发现重复实体组 'profit before tax', 将合并 2 个节点 -> 保留 entityID: [0, 5, 0]
2025-09-12 09:11:58,943 - INFO - 第一轮消歧后，图谱剩余 153 个元素
2025-09-12 09:11:58,981 - INFO - 第二轮消歧后，图谱最终剩余 153 个元素
2025-09-12 09:11:58,981 - INFO - 共找到 31 个包含向量的节点准备存储
